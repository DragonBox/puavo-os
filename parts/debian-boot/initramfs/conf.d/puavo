# We support one method to call the init-puavo.d scripts.
# Pass "init=/sbin/init-puavo" as kernel argument, which will execute
# the scripts in the real system and chain to /sbin/init after that.

for x in $(cat /proc/cmdline); do
    if [ "$x" = "init=/sbin/init-puavo" ]; then
        BOOT=puavo
    fi
done

if [ "$BOOT" = "puavo" ]; then
    export PUAVO_BOOTMODE=

    # Set default PUAVO_BOOTMODE based on "puavo.hosttype".
    # In the future we can probably drop support for "puavo.hosttype"
    # once we can rely puavo.bootmode is always set.
    PUAVO_HOSTTYPE=
    for x in $(cat /proc/cmdline); do
        case $x in
            puavo.hosttype=*)
                PUAVO_HOSTTYPE="${x#puavo.hosttype=}"
                ;;
        esac
    done
    case $PUAVO_HOSTTYPE in
        bootserver|diskinstaller|laptop|preinstalled|wirelessaccesspoint)
            PUAVO_BOOTMODE=local
            ;;
        fatclient|ltspserver|thinclient|unregistered)
            PUAVO_BOOTMODE=net
            ;;
    esac

    # explicitly set "puavo.bootmode" is always effective
    for x in $(cat /proc/cmdline); do
        case $x in
            puavo.bootmode=*)
                PUAVO_BOOTMODE="${x#puavo.bootmode=}"
                ;;
        esac
    done
fi
