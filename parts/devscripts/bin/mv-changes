#!/bin/sh

set -eu

if [ $# -ne 2 ]; then
    echo "Error: Invalid number of arguments ($#), expected 2" >&2
    echo "Usage: $0 CHANGES_FILE TARGET_DIR" >&2
    exit 1
fi

changes_file=$1
target_dir=$2

source_dir=$(dirname "${changes_file}")

mkdir -p "${target_dir}"

awk -v"source_dir=${source_dir}" \
    'NR == 1, /^Files:$/ { next } { printf "%s/%s%c", source_dir, $5, 0 }' \
    "${changes_file}" | xargs -0 mv -v -n -t "${target_dir}"

mv -v -n -t "${target_dir}" "${changes_file}"
