#!/bin/sh

set -eu

if [ "$(id -u)" != 0 ]; then
  echo 'Run me as root!' >&2
  exit 1
fi

/root/puavo-configure-image --prepare-image

imagename=$(/root/puavo-configure-image --get-imagename)

mkdir -p /images
mksquashfs / "/images/${imagename}.tmp" -noappend \
           -ef /etc/puavo-image-tools/puavoimage-live.excludes -wildcards
mv "/images/${imagename}.tmp" "/images/${imagename}"

echo "Image $imagename has been created and installed to /images/${imagename}"
