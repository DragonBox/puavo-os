# Mount Puavo configuration partition from local hard drive and use 
# files created by puavo-register script. Used by Puavo LTSP servers to 
# get registration information needed for sssd and kerberos principal 
# for NFS mounts.
#
# Checks if LVM partition /dev/mapper/puavo-config exists and mounts it
# as /mnt/puavoconfig.

if [ -x "/sbin/vgchange" ]; then
  vgchange -a y

  if [ -b "/dev/mapper/puavo-config" ]; then
    mkdir -p /mnt/puavoconfig
    mount /dev/mapper/puavo-config /mnt/puavoconfig

    if [ -d "/mnt/puavoconfig/puavo" ]; then
      rm -rf /etc/puavo /etc/krb5.keytab
      ln -s /mnt/puavoconfig/puavo /etc/
      ln -s /mnt/puavoconfig/krb5.keytab /etc/
    fi
  fi
fi
