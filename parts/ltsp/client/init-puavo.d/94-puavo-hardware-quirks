has_device_tag() {
  jq -r '.tags[]' /etc/puavo/device.json 2>/dev/null | grep -qx "$1"
}

# blacklist yenta_socket by default, it causes boot failures on some hardware
if has_device_tag no_blacklist_yenta_socket \
     && ! has_device_tag no_no_blacklist_yenta_socket; then
  rm -f /etc/modprobe.d/blacklist-yenta_socket.conf
else
  cat <<'EOF' > /etc/modprobe.d/blacklist-yenta_socket.conf
blacklist yenta_socket
EOF
fi
