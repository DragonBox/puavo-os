set_systemd_default_target()
{
    local hosttype

    hosttype=$(cat /etc/puavo/hosttype)
    case "${hosttype}" in
        fatclient)
            systemctl set-default graphical.target
            ;;
        laptop)
            if awk '$2 == "/rofs" && $1 ~ /\/dev\/nbd[0-9]+/ {exit 1}' /proc/mounts; then
                systemctl set-default graphical.target
            else
                # Laptop having its root filesystem mounted
                # from network goes to admin menu. It provides
                # tools to update the system etc.
                systemctl set-default multi-user.target
            fi
            ;;
        *)
            systemctl set-default multi-user.target
            ;;
    esac
}

set_systemd_default_target
