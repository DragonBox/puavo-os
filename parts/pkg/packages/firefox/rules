#!/bin/sh

set -eu

command=$1
shift

case "${command}" in
    configure)
	upstream_dir=$1

	ln -fns "${upstream_dir}" /opt/firefox
        ln -fns /opt/firefox/firefox /usr/local/bin/firefox

        update-alternatives --install /usr/bin/x-www-browser x-www-browser \
                            /usr/local/bin/firefox 200

	cat <<'EOF' > /usr/share/applications/firefox.desktop
[Desktop Entry]
Name=Firefox
Comment=Web Browser
GenericName=Web Browser
X-GNOME-FullName=Firefox Web Browser
Exec=/opt/firefox/firefox %u
Terminal=false
X-MultipleArgs=false
Type=Application
Icon=/opt/firefox/browser/chrome/icons/default/default128.png
Categories=Network;WebBrowser;
MimeType=text/html;text/xml;application/xhtml+xml;application/xml;application/vnd.mozilla.xul+xml;application/rss+xml;application/rdf+xml;image/gif;image/jpeg;image/png;x-scheme-handler/http;x-scheme-handler/https;
StartupWMClass=Firefox
StartupNotify=true
EOF
	;;
    unconfigure)
	rm -f /opt/firefox \
              /usr/local/bin/firefox \
              /usr/share/applications/firefox.desktop
        update-alternatives --remove x-www-browser /usr/local/bin/firefox
	;;
    unpack)
	upstream_pack=$1
	upstream_dir=$2

	tar --no-same-owner -x -f "${upstream_pack}" \
            -C "${upstream_dir}" --strip-components=1
	;;
    *)
	;;
esac
