#!/bin/sh

set -eu

services='
  avahi-daemon
  fluentd
  incron
  isc-dhcp-server
  krb5-kdc
  ModemManager
  nbd-server
  NetworkManager
  nfs-server
  nscd
  nslcd
  puavo-rest
  puavo-tftpd
  puavo-vpn-client-dnsmasq
  puavo-vpn-client-openvpn
  redis-server
  rpc-gssd
  shorewall
  slapd
  tlp
'

status=0

# XXX look if this is slow and could be optimized (skipping systemctl-tool?)

for service in ${services}; do
  enabled=$(puavo-conf "puavo.service.${service}.enabled")
  if [ "${enabled}" = 'true' ]; then
    if ! systemctl enable "${service}"; then
      echo "Could not enable ${service}" >&2
      status=1
    fi
  else
    if ! systemctl disable "${service}"; then
      echo "Could not disable ${service}" >&2
      status=1
    fi
  fi
done

exit $status
