#!/bin/sh

#!/bin/sh

set -eu

while [ $# -gt 0 ]; do
    case $1 in
        -h|--help)
            shift
            echo "Usage: $0 [OPTION]... CHANGES_FILE"
            echo
            echo 'Build Debian package.'
            echo
            echo "Options:"
            echo "    -h, --help                   print help and exit"
            echo
            exit 0
            ;;
        --)
            shift
            break
            ;;
        -*)
            echo "error: invalid argument '$1'" >&2
            exit 1
            ;;
        *)
            break
            ;;
    esac
done

if [ $# -ne 1 ]; then
    echo "Error: Invalid number of arguments ($#), expected 1" >&2
    echo "Usage: $0 CHANGES_FILE" >&2
    exit 1
fi

changes_file=$(basename "$1")
shift

package=$(echo "${changes_file}" | sed -r -n 's/^(.*?)_[0-9]+.*$/\1/p')

cd "${package}"
debian/scripts/get-orig-source
dpkg-buildpackage -b -uc
