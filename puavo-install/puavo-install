#!/bin/sh

set -e

puavo-register

hosttype="$(cat /etc/puavo/hosttype)"

case "$hosttype" in
  laptop)
    puavo-setup-filesystems

    mkdir -p /state/etc
    cp -aT /etc/puavo /state/etc/puavo

    puavo-install-ltspimages
    puavo-install-grub

    sync
    umount /state /images /home
    ;;
  ltspserver)
    puavo-setup-filesystems
    cp -a /etc/puavo /state

    sync
    umount /state
    ;;
esac
