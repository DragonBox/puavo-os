#!/bin/sh

set -eu

gtk_bookmarks() {
  _networkfolder_displayname=$1
  _schoolsharedir=$2
  _share_displayname=$3

  case "$(cat /etc/puavo/hosttype)" in
    laptop)
      # Add two bookmarks: to user home directory on server, and to shared
      # directories on server.
      echo "sftp://homedir:222${HOME} * ${_networkfolder_displayname}"
      echo "stfp://homedir:222${_schoolsharedir} * ${_share_displayname}"
      ;;
    *)
      # add a bookmark pointing to shared directories
      echo "file://${_schoolsharedir} * ${_share_displayname}"
      ;;
  esac

  # Pick up user's own bookmarks too (we treat all bookmarks with "* "-prefix
  # as something we have full control over).  We create the bookmarks file
  # first if it does not exist.
  if ! [ -e ~/.gtk-bookmarks ]; then
    /usr/bin/xdg-user-dirs-update
    /usr/bin/xdg-user-dirs-gtk-update
  fi
  awk '$2 != "*"' ~/.gtk-bookmarks
}

schoolgroup=$(id -gn)
lang=$(echo $LANG | cut -c 1-2)

case "$lang" in
  fi)
    networkfolder_displayname='Verkkokansio'
    share_displayname='Yhteiset'
    share_pathtranslation='yhteiset'
    ;;
  sv)
    networkfolder_displayname='NÃ¤tverksmapp'
    share_displayname='Delade Filer'
    share_pathtranslation='delade_filer'
    ;;
  *)
    networkfolder_displayname='Network folder'
    share_displayname='Share'
    share_pathtranslation='share'
    ;;
esac

schoolsharedir=/home/share/${share_pathtranslation}/${schoolgroup}

gtk_bookmarks "$networkfolder_displayname" \
              "$schoolsharedir"            \
              "$share_displayname"         \
  > ~/.gtk-bookmarks.tmp
mv ~/.gtk-bookmarks.tmp ~/.gtk-bookmarks
