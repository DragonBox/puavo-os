if [ -n "$SERVER" ]; then
  # set --max-time to 30 seconds to allow the boot to continue in case of
  # failure; so we can check out later (with ssh or some such) what went wrong.
  if curl --cacert /etc/puavo/certs/rootca.pem \
          --fail \
          --max-time 30 \
          --silent \
          "$(puavo-resolve-api-server)/v3/devices/$(hostname)" \
       > /etc/puavo/device.json.tmp; then
    mv /etc/puavo/device.json.tmp /etc/puavo/device.json
  else
    rm -f /etc/puavo/device.json.tmp
  fi
fi
