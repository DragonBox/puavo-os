#!/bin/sh

set -eu

rootfs_dir=${1:-}
home_dir=${2:-}
uid=${3:-}
gid=${4:-}

if [ -z "$rootfs_dir" -o -z "$home_dir" -o -z "$uid" -o -z "$gid" ]; then
  echo "Usage: $(basename $0) rootfs_dir home_dir uid gid" >&2
  exit 1
fi

if ! grep -q '^puavoadmins:' "${rootfs_dir}/etc/group"; then
  groupadd -R "$rootfs_dir" -g "$gid" puavoadmins
fi

if ! grep -q '^admin:' "${rootfs_dir}/etc/passwd"; then
  useradd -R "$rootfs_dir" -d "$home_dir" -g puavoadmins -u "$uid" admin
fi
